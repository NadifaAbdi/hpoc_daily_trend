---
title: "Epi Trends Report"
subtitle: '`r params$date`'
output: 
  powerpoint_presentation:
    reference_doc: src/template.pptx
params:
  date: !r Sys.Date()
  region:
    label: "Select which P/Ts to include in report"
    value: Major provinces
    input: select
    choices: [All P/Ts, Major provinces]        
---
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)

# Import data from network drive using Python
library(reticulate)
source_python("src/00_get_data.py")

# Load libraries
library(tidyverse)
library(patchwork)
library(scales)
library(zoo)
library(lubridate)
library(gridExtra)
library(ggrepel)
library(ggthemes)
library(cansim)
library(janitor)
library(xml2)
library(rvest)
library(stringr)

# Import data
source("src/00_get_data.R")
source("src/07_lab_metrics.R")

list_pt <- if (params$region == "Major provinces") c("Canada", "British Columbia","Alberta", "Saskatchewan", "Manitoba",
                                                     "Ontario", "Quebec") else 
                                                             c("Canada", "British Columbia","Alberta", "Saskatchewan", "Manitoba",
                                                     "Ontario", "Quebec", "New Brunswick", "Prince Edward Island", "Nova Scotia", 
                                                     "Newfoundland and Labrador", "Northwest Territories", "Nunavut", "Yukon")
two_weeks_ago <- params$date - weeks(2)
```

## Summary

- Bullet 1
- Bullet 2
- Bullet 3

```{r CD, code=xfun::read_utf8('src/01_cd_slides.R'), results='asis', message=FALSE, warning=FALSE, fig.height = 9, fig.width = 20}
```

## Daily cases by Jurisdiction (7-day moving average)

```{r PT C, code=xfun::read_utf8('src/03_pt_slides.R'), results = "hide", message=FALSE, warning=FALSE, fig.height = 9, fig.width = 20}
```

## COVID-19 patients in hospital daily across Canada 

```{r Can HI, code=c(Sys.setenv(hosp_prname="Canada"), xfun::read_utf8('src/05_hosp_slides.R')), results = "hide", message=FALSE, warning=FALSE, fig.height = 9, fig.width = 20}
```

## COVID-19 patients in hospital daily in selected provinces and territories 

```{r PT HI, code=c(Sys.setenv(hosp_prname="pts"), xfun::read_utf8('src/05_hosp_slides.R')), results = "hide", message=FALSE, warning=FALSE, fig.height = 9, fig.width = 20}
```

## COVID-19 patients in hospital daily in selected provinces and territories 

Indicators derived from the Case Report Forms

## COVID-19 cases by age, Canada
```{r Canada Age C, code=c(Sys.setenv(age_prname="Canada"), xfun::read_utf8('src/04_age_slides.R')), results = "hide", message=FALSE, warning=FALSE, fig.height = 9, fig.width = 20}
```

## COVID-19 cases by age, select provinces and territories
```{r PT Age C, code=c(Sys.setenv(age_prname="pts"), xfun::read_utf8('src/04_age_slides.R')), results = "hide", message=FALSE, warning=FALSE, fig.height = 9, fig.width = 20}
```

## Lab metrics
```{r}

ft <- flextable(Metrics)
ft <- autofit(ft)
ft
```

## Estimate for case detection: Onset to lab collection (days)
```{r Lab Onset, code=xfun::read_utf8('src/08_lab_onset.R'), results = "hide", message=FALSE, warning=FALSE, fig.height = 9, fig.width = 20}
```

## Daily Cases by Country (7-day moving average, population adjusted)

```{r Int C, code=xfun::read_utf8('src/02_int_slides.R'), results = "hide", message=FALSE, warning=FALSE, fig.height = 9, fig.width = 20}
```
